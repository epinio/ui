"use strict";(("undefined"!==typeof self?self:this)["webpackChunkepinio_1_12_0_rc6"]=("undefined"!==typeof self?self:this)["webpackChunkepinio_1_12_0_rc6"]||[]).push([[775],{40775:function(e,t,a){a.d(t,{A:function(){return O}});var s=a(9274);const r={class:"mt-20"};function o(e,t,a,o,n,l){const i=(0,s.resolveComponent)("Conditions"),d=(0,s.resolveComponent)("Tab"),c=(0,s.resolveComponent)("PaginatedResourceTable"),u=(0,s.resolveComponent)("RelatedResources"),h=(0,s.resolveComponent)("Tabbed"),p=(0,s.resolveDirective)("t");return(0,s.openBlock)(),(0,s.createBlock)(h,(0,s.mergeProps)(e.$attrs,{"default-tab":a.defaultTab,resource:a.value,"use-hash":a.useHash,onChanged:l.tabChange}),{default:(0,s.withCtx)((()=>[(0,s.renderSlot)(e.$slots,"default"),n.showConditions?((0,s.openBlock)(),(0,s.createBlock)(d,{key:0,"label-key":"resourceTabs.conditions.tab",name:"conditions",weight:-1,"display-alert-icon":l.conditionsHaveIssues},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(i,{value:a.value},null,8,["value"])])),_:1},8,["display-alert-icon"])):(0,s.createCommentVNode)("",!0),l.showEvents?((0,s.openBlock)(),(0,s.createBlock)(d,{key:1,"label-key":"resourceTabs.events.tab",name:"events",weight:-2},{default:(0,s.withCtx)((()=>["events"===n.selectedTab?((0,s.openBlock)(),(0,s.createBlock)(c,{key:0,schema:n.eventSchema,"local-filter":l.filterEventsLocal,"api-filter":l.filterEventsApi,"use-query-params-for-simple-filtering":!1,headers:l.eventHeaders,paginationHeaders:n.paginationHeaders,namespaced:!1},null,8,["schema","local-filter","api-filter","headers","paginationHeaders"])):(0,s.createCommentVNode)("",!0)])),_:1})):(0,s.createCommentVNode)("",!0),l.showRelated?((0,s.openBlock)(),(0,s.createBlock)(d,{key:2,name:"related","label-key":"resourceTabs.related.tab",weight:-3},{default:(0,s.withCtx)((()=>[(0,s.withDirectives)((0,s.createElementVNode)("h3",null,null,512),[[p,"resourceTabs.related.from"]]),(0,s.createVNode)(u,{"ignore-types":[a.value.type],value:a.value,direction:"from"},null,8,["ignore-types","value"]),(0,s.withDirectives)((0,s.createElementVNode)("h3",r,null,512),[[p,"resourceTabs.related.to"]]),(0,s.createVNode)(u,{"ignore-types":[a.value.type],value:a.value,direction:"to"},null,8,["ignore-types","value"])])),_:1})):(0,s.createCommentVNode)("",!0)])),_:3},16,["default-tab","resource","use-hash","onChanged"])}var n=a(58700),l=a(49584),i=a(14220),d=a(65375),c=(0,s.defineComponent)({...d.A,props:{mode:{type:String,default:i.G5},realMode:{type:String,default:i.G5},as:{type:String,default:i.zD},value:{type:Object,required:!0},initialValue:{type:Object,default:null},liveValue:{type:Object,default:null},doneEvent:{type:Boolean,default:!1},useTabbedHash:{type:Boolean,default:void 0}}});function u(e,t,a,r,o,n){const l=(0,s.resolveComponent)("SortableTable");return(0,s.openBlock)(),(0,s.createBlock)(l,{headers:n.headers,rows:n.rows,"key-field":"condition","default-sort-by":"condition","table-actions":!1,"row-actions":!1,search:!1},{"cell:condition":(0,s.withCtx)((({row:e})=>[(0,s.createElementVNode)("span",{class:(0,s.normalizeClass)({"text-error":e.error})},(0,s.toDisplayString)(e.condition),3)])),"cell:status":(0,s.withCtx)((({row:e})=>[(0,s.createElementVNode)("span",{class:(0,s.normalizeClass)({"text-error":e.error})},(0,s.toDisplayString)(e.status),3)])),_:1},8,["headers","rows"])}var h=a(26529),p={components:{SortableTable:h.A},props:{value:{type:Object,default:()=>({})}},computed:{headers(){return[{name:"condition",labelKey:"tableHeaders.condition",value:"condition",width:150,sort:"condition",dashIfEmpty:!0},{name:"status",labelKey:"tableHeaders.status",value:"status",width:75,sort:"status",dashIfEmpty:!0},{name:"time",labelKey:"tableHeaders.updated",value:"time",sort:"time",formatter:"LiveDate",formatterOpts:{addSuffix:!0},width:125,dashIfEmpty:!0},{name:"message",labelKey:"tableHeaders.message",value:"message",sort:["message"],dashIfEmpty:!0}]},rows(){return(this.value.status?.conditions||[]).map((e=>{let t=e.message||"";return e.reason&&(t=`[${e.reason}] ${t}`.trim()),{condition:e.type||"Unknown",status:e.status||"Unknown",error:e.error,time:e.lastProbeTime||e.lastUpdateTime||e.lastTransitionTime,message:t}}))}}},m=a(47433);const f=(0,m.A)(p,[["render",u]]);var g=f,b=a(35664);function y(e,t,a,r,o,n){const l=(0,s.resolveComponent)("ResourceTable");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createVNode)(l,(0,s.mergeProps)({ref:"table"},e.$attrs,{schema:e.schema,rows:e.rows,"alt-loading":e.canPaginate&&!e.isFirstLoad,loading:e.loading,groupable:e.groupable,headers:e.safeHeaders,namespaced:e.namespaced,"external-pagination-enabled":e.canPaginate,"external-pagination-result":e.paginationResult,onPaginationChanged:e.paginationChanged}),(0,s.createSlots)({_:2},[(0,s.renderList)(e.$slots,((t,a)=>({name:a,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,a,(0,s.normalizeProps)((0,s.guardReactiveProps)(t)))]))})))]),1040,["schema","rows","alt-loading","loading","groupable","headers","namespaced","external-pagination-enabled","external-pagination-result","onPaginationChanged"])])}var v=a(72586),w=a(76568),C=(0,s.defineComponent)({name:"PaginatedResourceTable",components:{ResourceTable:w.A},mixins:[v.A],props:{schema:{type:Object,required:!0},headers:{type:Array,default:null},paginationHeaders:{type:Array,default:null},groupable:{type:Boolean,default:null},namespaced:{type:Boolean,default:null},fetchSecondaryResources:{type:Function,default:null},fetchPageSecondaryResources:{type:Function,default:null}},data(){return{resource:this.schema.id}},async fetch(){const e=[this.$fetchType(this.resource,[],this.inStore)];this.fetchSecondaryResources&&e.push(this.fetchSecondaryResources({canPaginate:this.canPaginate})),await Promise.all(e)},computed:{safeHeaders(){const e=this.canPaginate?this.paginationHeaders:this.headers;return e||this.$store.getters["type-map/headersFor"](this.schema,this.canPaginate)}},methods:{clearSelection(){this.$refs.table.clearSelection()}}});const S=(0,m.A)(C,[["render",y]]);var T=S;function $(e,t,a,r,o,n){const l=(0,s.resolveComponent)("BadgeState"),i=(0,s.resolveComponent)("ResourceTable");return(0,s.openBlock)(),(0,s.createBlock)(i,{schema:null,rows:n.rows,headers:n.headers,search:!1,"table-actions":!1,namespaced:!0,"mangle-action-resources":n.getRealResources,"paging-label":"sortableTable.paging.generic",groupable:!1},{"cell:state":(0,s.withCtx)((({row:e})=>[(0,s.createVNode)(l,{value:e},null,8,["value"])])),_:1},8,["rows","headers","mangle-action-resources"])}var k=a(4065),R=a(68774),B=a(74302),x=a(27278),H=a(41418),E={components:{ResourceTable:w.A,BadgeState:H.j},props:{value:{type:Object,required:!0},rel:{type:String,default:null},direction:{type:String,default:"to"},ignoreTypes:{type:Array,default:()=>[]}},data(){return{loadedResources:1}},computed:{filteredRelationships(){let e=this.value?.metadata?.relationships||[];return e=e.filter((e=>{const t=e[`${this.direction}Type`];return!(!t||this.ignoreTypes.includes(t))&&(!this.rel||e.rel===this.rel)})),e},rows(){if(this.loadedResources<1)return;const e=this.$store.getters["clusterId"],t=this.$store.getters["currentStore"](),a=[];for(const s of this.filteredRelationships){const r=s[`${this.direction}Type`],o=s.state||this.$store.getters[`${t}/byId`](r,s[`${this.direction}Id`])?.state||k.jv.MISSING,n=(0,k.uU)(o,s.error,s.transitioning),l=this.$store.getters[`${t}/schemaFor`](r);let i=s[`${this.direction}Id`];if(!i)continue;let d=null;const c=i.indexOf("/"),u=`${r}/${d}/${i}`;c>0&&(d=i.substr(0,c),i=i.substr(c+1));const h={name:`c-cluster-product-resource${d?"-namespace":""}-id`,params:{product:x.o,cluster:"management"===t?"local":e,resource:r,namespace:d,id:i}};a.push({type:r,id:s[`${this.direction}Id`],state:o,metadata:{namespace:d,name:i},_key:u,name:i,namespace:d,nameDisplay:i,nameSort:(0,B.RY)(i).toLowerCase(),stateColor:n,detailLocation:h,typeDisplay:this.$store.getters["type-map/labelFor"](l),stateDisplay:(0,k.ch)(o),stateBackground:n.replace("text-","bg-"),groupByLabel:d})}return a},headers(){return[R.c4,R.ZE,R.o_,R.CU]}},methods:{async getRealResources(e){const t=this.$store.getters["currentStore"](),a=await Promise.allSettled(e.map((e=>this.$store.dispatch(`${t}/find`,{type:e.type,id:e.id})))),s=[];for(let r=0;r<a.length;r++)"fulfilled"===a[r].status&&s.push(a[r].value);return this.loadedResources++,s}}};const P=(0,m.A)(E,[["render",$]]);var V=P,A=a(50025),_=a(57699),N=a(46392),I={name:"ResourceTabs",components:{Tabbed:n.A,Tab:l.A,Conditions:g,PaginatedResourceTable:T,RelatedResources:V},mixins:[c],props:{value:{type:Object,default:()=>({})},mode:{type:String,default:i.nW},defaultTab:{type:String,default:null},needConditions:{type:Boolean,default:!0},needEvents:{type:Boolean,default:!0},needRelated:{type:Boolean,default:!0},extensionParams:{type:Object,default:null},useHash:{type:Boolean,default:!0}},data(){const e=this.$store.getters["currentStore"](b.ll),t=this.$store.getters[`${e}/schemaFor`](b.ll),a=t?[_.ke,_.qI,R.rh,(0,N.UQ)("Subobject",t,this.$store.getters,!0),(0,N.UQ)("Source",t,this.$store.getters,!0),R.w5,(0,N.UQ)("First Seen",t,this.$store.getters,!0),(0,N.UQ)("Count",t,this.$store.getters,!0),_.l3]:[];return{eventSchema:t,EVENT:b.ll,selectedTab:this.defaultTab,inStore:e,showConditions:!1,paginationHeaders:a}},beforeUnmount(){this.$store.dispatch("cluster/forgetType",b.ll)},fetch(){this.setShowConditions()},computed:{showEvents(){return this.isView&&this.needEvents&&this.eventSchema},showRelated(){return this.isView&&this.needRelated},eventHeaders(){return[{name:"type",label:this.t("tableHeaders.type"),value:"eventType",sort:"eventType"},{name:"reason",label:this.t("tableHeaders.reason"),value:"reason",sort:"reason"},{name:"date",label:this.t("tableHeaders.updated"),value:"date",sort:"date:desc",formatter:"LiveDate",formatterOpts:{addSuffix:!0},width:125},{name:"message",label:this.t("tableHeaders.message"),value:"message",sort:"message"}]},conditionsHaveIssues(){return!!this.showConditions&&this.value.status?.conditions?.filter((e=>!(0,k.rv)(e))).some((e=>e.error))}},methods:{tabChange(e){this.selectedTab=e?.selectedName},async setShowConditions(){this.isView&&this.needConditions&&this.value?.type&&this.schema?.fetchResourceFields&&(await this.schema.fetchResourceFields(),this.showConditions=this.$store.getters[`${this.inStore}/pathExistsInSchema`](this.value.type,"status.conditions"))},filterEventsLocal(e){return e.filter((e=>e.involvedObject?.uid===this.value?.metadata?.uid))},filterEventsApi(e){e.filters||(e.filters=[]);const t="involvedObject.uid";let a=null;for(let r=0;r<e.filters.length;r++){const s=e.filters[r];if(s.fields.find((e=>e.field===t))){a=s;break}}const s=A.eY.createSingleField({field:t,exact:!0,value:this.value.metadata.uid,equals:!0});return a?Object.assign(a,s):e.filters.push(s),e}}};const j=(0,m.A)(I,[["render",o]]);var O=j}}]);
//# sourceMappingURL=epinio-1.12.0-rc6.umd.min.775.js.map