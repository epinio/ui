(("undefined"!==typeof self?self:this)["webpackJsonpepinio_1_11_0_1"]=("undefined"!==typeof self?self:this)["webpackJsonpepinio_1_11_0_1"]||[]).push([[13],{"34a2":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("Window",{staticClass:"epinio-app-log",attrs:{active:t.active,"before-close":t.cleanup},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"title-inner log-action"},[e("div",{staticClass:"title-inner-left"},[t.instanceChoices.length>1?e("Select",{staticClass:"containerPicker auto-width",attrs:{disabled:1===t.instanceChoices.length,options:t.instanceChoicesWithNone,clearable:!0,placement:"top",placeholder:"Filter by Instance"},scopedSlots:t._u([{key:"selected-option",fn:function(s){return[s?e("t",{attrs:{k:"epinio.applications.wm.containerName",label:s.label}}):t._e()]}}],null,!1,3795906717),model:{value:t.instance,callback:function(e){t.instance=e},expression:"instance"}}):t._e(),e("button",{staticClass:"btn bg-primary ml-5",attrs:{disabled:t.isFollowing},on:{click:t.follow}},[e("t",{attrs:{k:"wm.containerLogs.follow"}})],1),e("button",{staticClass:"btn bg-primary ml-5",on:{click:t.clear}},[e("t",{attrs:{k:"wm.containerLogs.clear"}})],1),e("AsyncButton",{staticClass:"ml-5",attrs:{mode:"download"},on:{click:t.download}})],1),e("div",{staticStyle:{flex:"1"}}),e("div",{staticClass:"title-inner-right"},[e("div",{staticClass:"status log-action text-center p-10",staticStyle:{"min-width":"80px"}},[e("t",{class:{"text-success":t.isOpen,"text-error":!t.isOpen},attrs:{k:t.isOpen?"wm.connection.connected":"wm.connection.disconnected"}})],1),e("div",{staticClass:"log-action ml-5"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"input-sm",attrs:{type:"search",placeholder:t.t("wm.containerLogs.search")},domProps:{value:t.search},on:{input:function(e){e.target.composing||(t.search=e.target.value)}}})]),e("div",{staticClass:"log-action ml-5"},[e("v-popover",{attrs:{trigger:"click",placement:"top"}},[e("button",{staticClass:"btn bg-primary"},[e("i",{staticClass:"icon icon-gear"})]),e("template",{slot:"popover"},[e("div",{staticClass:"filter-popup"},[e("div",[e("Checkbox",{attrs:{label:t.t("wm.containerLogs.wrap"),value:t.wrap},on:{input:t.toggleWrap}})],1)])])],2)],1)])])]},proxy:!0},{key:"body",fn:function(){return[e("div",{ref:"body",class:{"logs-container":!0,open:t.isOpen,closed:!t.isOpen,"show-times":t.timestamps&&t.filtered.length,"wrap-lines":t.wrap}},[e("table",{staticClass:"fixed",attrs:{cellpadding:"0",cellspacing:"0"}},[e("tbody",{staticClass:"logs-body"},[t.filtered.length?t._l(t.filtered,(function(s){return e("tr",{key:s.id},[e("td",{directives:[{name:"clean-html",rawName:"v-clean-html",value:t.format(s.time),expression:"format(line.time)"}],key:s.id+"-time",staticClass:"time"}),e("td",{directives:[{name:"clean-html",rawName:"v-clean-html",value:s.msg,expression:"line.msg"}],key:s.id+"-msg",staticClass:"msg"})])})):t.search?e("tr",[e("td",{directives:[{name:"t",rawName:"v-t",value:"wm.containerLogs.noMatch",expression:"'wm.containerLogs.noMatch'"}],staticClass:"msg text-muted",attrs:{colspan:"2"}})]):e("tr",{directives:[{name:"t",rawName:"v-t",value:"epinio.applications.wm.noData",expression:"'epinio.applications.wm.noData'"}],staticClass:"msg text-muted",attrs:{colspan:"2"}})],2)])])]},proxy:!0}])})},n=[],a=s("694b"),o=s.n(a),l=s("4048"),c=s("5000"),r=s("0df0"),d=s("d709"),h=s("050d"),p=s.n(h),u=s("47ab"),g=s("2cb5"),f=s("98e3"),m=s("6147"),b=s("c87d"),v=s("744f");let w=1;const k=new o.a;var y={components:{Window:m["a"],Checkbox:r["a"],AsyncButton:d["b"],Select:u["a"]},mixins:[v["default"]],props:{ansiToHtml:{type:Boolean,default:!1}},data(){return{isFollowing:!0,timestamps:this.$store.getters["prefs/get"](c["k"]),wrap:this.$store.getters["prefs/get"](c["l"]),search:"",lines:[],instance:""}},computed:{instanceChoicesWithNone(){return[...this.instanceChoices,{label:"No Instance Filter",value:null}]},filtered(){if(!this.search&&!this.instance)return this.lines;const t=new RegExp(Object(g["i"])(this.search),"img"),e=[];for(const s of this.lines){let i=s.rawMsg;if(this.instance){const t=i.substring(1,i.length);if(!t.startsWith(this.instance))continue}const n=i.match(t);if(!n)continue;const a=i.split(t);i="";while(a.length||n.length)a.length&&(i+=k.ansi_to_html(a.shift())),n.length&&(i+=`<span class="highlight">${k.ansi_to_html(n.shift())}</span>`);e.push({id:s.id,time:s.time,msg:i})}return e},timeFormatStr(){const t=Object(g["h"])(this.$store.getters["prefs/get"](c["b"])),e=Object(g["h"])(this.$store.getters["prefs/get"](c["o"]));return`${t} ${e}`}},beforeDestroy(){this.$refs.body.removeEventListener("scroll",this.boundUpdateFollowing),this.cleanup()},async mounted(){await this.connect(),this.boundUpdateFollowing=this.updateFollowing.bind(this),this.$refs.body.addEventListener("scroll",this.boundUpdateFollowing),this.boundFlush=this.flush.bind(this),this.timerFlush=setInterval(this.boundFlush,100)},methods:{async getSocketUrl(){const{url:t,token:e}=await this.getRootSocketUrl();return Object(l["b"])(t,{follow:!0,authtoken:e})},async connect(){this.socket&&(await this.socket.disconnect(),this.socket=null,this.lines=[]),this.lines=[];const t=await this.getSocketUrl();this.socket=new f["f"](t,!0,0),this.socket.setAutoReconnectUrl(async()=>await this.getSocketUrl()),this.socket.addEventListener(f["a"],t=>{this.isOpen=!0}),this.socket.addEventListener(f["d"],t=>{this.isOpen=!1}),this.socket.addEventListener(f["c"],t=>{this.isOpen=!1,console.error("Connect Error",t)}),this.socket.addEventListener(f["e"],t=>{let e;try{e=JSON.parse(t.detail.data)}catch(t){return void console.warn("Unable to parse websocket data: ",t.detail.data)}const{PodName:s,Message:i}=e,n=`[${s}] ${i}`;this.backlog.push({id:w++,msg:this.ansiToHtml?k.ansi_to_html(n):n,rawMsg:n})}),this.socket.connect()},flush(){this.backlog.length&&(this.lines.push(...this.backlog),this.backlog=[]),this.isFollowing&&this.$nextTick(()=>{this.follow()})},updateFollowing(){const t=this.$refs.body;this.isFollowing=t.scrollTop+t.clientHeight+2>=t.scrollHeight},clear(){this.lines=[]},download(t){const e=(new Date).toISOString().split(".")[0],s=`${this.application.nameDisplay}-${e}`;Object(b["a"])(s,this.lines.map(t=>""+t.rawMsg).join("\n")).then(()=>t(!0)).catch(()=>t(!1))},follow(){const t=this.$refs.body;t.scrollTop=t.scrollHeight},toggleWrap(t){this.wrap=t,this.$store.dispatch("prefs/set",{key:c["l"],value:this.wrap})},format(t){return t?p()(t).format(this.timeFormatStr):""},cleanup(){this.socket&&(this.socket.disconnect(),this.socket=null),clearInterval(this.timerFlush)}}},x=y,C=(s("92ff"),s("84af"),s("d802")),O=Object(C["a"])(x,i,n,!1,null,"c5dcdb42",null);e["default"]=O.exports},3527:function(t,e,s){var i=s("df43");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=s("0ed3").default;n("54f05a20",i,!0,{sourceMap:!1,shadowMode:!1})},"360c":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("Window",{staticClass:"epinio-app-shell",attrs:{active:t.active,"before-close":t.cleanup},scopedSlots:t._u([{key:"title",fn:function(){return[t.instanceChoices.length>1?e("Select",{staticClass:"containerPicker auto-width pull-left",attrs:{disabled:1===t.instanceChoices.length,options:t.instanceChoices,clearable:!1,placement:"top"},scopedSlots:t._u([{key:"selected-option",fn:function(s){return[s?e("t",{attrs:{k:"epinio.applications.wm.containerName",label:s.label}}):t._e()]}}],null,!1,3795906717),model:{value:t.instance,callback:function(e){t.instance=e},expression:"instance"}}):t._e(),e("div",{staticClass:"pull-left ml-5"},[e("button",{staticClass:"btn btn-sm bg-primary",on:{click:t.clear}},[e("t",{attrs:{k:"wm.containerShell.clear"}})],1)]),e("div",{staticClass:"status pull-left"},[t.isOpen?e("t",{staticClass:"text-success",attrs:{k:"wm.connection.connected"}}):t.isOpening?e("t",{staticClass:"text-warning",attrs:{k:"wm.connection.connecting",raw:!0}}):e("t",{staticClass:"text-error",attrs:{k:"wm.connection.disconnected"}})],1)]},proxy:!0},{key:"body",fn:function(){return[e("div",{staticClass:"shell-container",class:{open:t.isOpen,closed:!t.isOpen}},[e("div",{ref:"xterm",staticClass:"shell-body"}),e("resize-observer",{on:{notify:t.fit}})],1)]},proxy:!0}])})},n=[],a=s("a8b9"),o=s("4048"),l=s("0f81"),c=s("47ab"),r=s("98e3"),d=s("6147"),h=s("744f"),p={components:{Window:d["a"],Select:c["a"]},mixins:[h["default"]],props:{initialInstance:{type:String,default:null}},data(){return{instance:this.initialInstance||this.instanceChoices[0],terminal:null,fitAddon:null,searchAddon:null,webglAddon:null,isOpening:!1,keepAliveTimer:null}},computed:{xtermConfig(){return{allowProposedApi:!0,cursorBlink:!0,useStyle:!0,fontSize:12}}},watch:{instance(){this.connect()},height(){this.fit()}},beforeDestroy(){clearInterval(this.keepAliveTimer),this.cleanup()},async mounted(){await this.setupTerminal(),await this.connect(),clearInterval(this.keepAliveTimer),this.keepAliveTimer=setInterval(()=>{this.fit()},6e4)},methods:{async setupTerminal(){const t=getComputedStyle(document.querySelector("body")),e=await s.e(12).then(s.t.bind(null,"2b0c",7)),i=await Object(a["a"])({fit:s.e(12).then(s.t.bind(null,"2b02",7)),webgl:s.e(12).then(s.t.bind(null,"be90",7)),weblinks:s.e(12).then(s.t.bind(null,"c257",7)),search:s.e(12).then(s.t.bind(null,"5d77",7))}),n=new e.Terminal({theme:{background:t.getPropertyValue("--terminal-bg").trim(),foreground:t.getPropertyValue("--terminal-text").trim(),cursor:t.getPropertyValue("--terminal-cursor").trim(),selectionBackground:t.getPropertyValue("--terminal-selection").trim()},...this.xtermConfig});this.fitAddon=new i.fit.FitAddon,this.searchAddon=new i.search.SearchAddon;try{this.webglAddon=new i.webgl.WebGlAddon}catch(o){this.webglAddon=null}n.loadAddon(this.fitAddon),n.loadAddon(this.searchAddon),n.loadAddon(new i.weblinks.WebLinksAddon),n.open(this.$refs.xterm),this.webglAddon&&n.loadAddon(this.webglAddon),this.fit(),this.flush(),n.onData(t=>{const e="0"+Object(l["b"])(t);this.write(e)}),this.terminal=n},write(t){this.isOpen?this.socket.send(t):this.backlog.push(t)},clear(){this.terminal.clear()},async getSocketUrl(){const{url:t,token:e}=await this.getRootSocketUrl();return Object(o["b"])(t,{authtoken:e,instance:this.instance})},async connect(){this.socket&&(await this.socket.disconnect(),this.socket=null,this.terminal.reset());const t=await this.getSocketUrl();t&&(this.socket=new r["f"](t,!1,0,"base64.channel.k8s.io"),this.socket.addEventListener(r["b"],t=>{this.isOpen=!1,this.isOpening=!0}),this.socket.addEventListener(r["c"],t=>{this.isOpen=!1,this.isOpening=!1,console.error("Connect Error",t)}),this.socket.addEventListener(r["a"],t=>{this.isOpen=!0,this.isOpening=!1,this.fit(),this.flush()}),this.socket.addEventListener(r["d"],t=>{this.isOpen=!1,this.isOpening=!1}),this.socket.addEventListener(r["e"],t=>{const e=t.detail.data.substr(0,1),s=Object(l["a"])(t.detail.data.substr(1));""+e==="1"?this.terminal.write(s):console.error(s)}),this.socket.connect(),this.terminal.focus())},flush(){const t=this.backlog.slice();this.backlog=[];for(const e of t)this.socket.send(e)},fit(t){if(!this.fitAddon)return;this.fitAddon.fit();const{rows:e,cols:s}=this.fitAddon.proposeDimensions();if(!this.isOpen)return;const i="4"+Object(l["b"])(JSON.stringify({Width:Math.floor(s),Height:Math.floor(e)}));this.socket.send(i)},cleanup(){this.socket&&(this.socket.disconnect(),this.socket=null),this.terminal&&(this.terminal.dispose(),this.terminal=null)}}},u=p,g=(s("bfea"),s("ef44"),s("d802")),f=Object(g["a"])(u,i,n,!1,null,"9b1a93e8",null);e["default"]=f.exports},"3d18":function(t,e,s){var i=s("cf46");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=s("0ed3").default;n("08bbedce",i,!0,{sourceMap:!1,shadowMode:!1})},"744f":function(t,e,s){"use strict";s.r(e);var i=s("90cd");e["default"]={props:{tab:{type:Object,required:!0},active:{type:Boolean,required:!0},height:{type:Number,required:!0},application:{type:Object,required:!0},endpoint:{type:String,required:!0}},data(){return{socket:null,isOpen:!1,backlog:[]}},computed:{instanceChoices(){return this.application.instances.map(t=>t.id)}},methods:{async getRootSocketUrl(){const{token:t}=await this.$store.dispatch("epinio/request",{opt:{url:"/api/v1/authtoken"}}),e=!!this.$store.getters["isSingleProduct"];let s="",n="";if(e){const t=this.$store.getters[i["f"]+"/singleProductCNSI"]();n="/pp/v1/direct/ws/"+(null===t||void 0===t?void 0:t.guid)}else{const t=this.$store.getters["clusterId"],e=this.$store.getters[i["e"]+"/byId"](i["h"].CLUSTER,t);s=e.api}return{url:`${s}${n}${this.endpoint}`.replace(/^http/,"ws"),token:t}}}}},"84af":function(t,e,s){"use strict";s("8db3")},"8db3":function(t,e,s){var i=s("ef3b");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=s("0ed3").default;n("799fa365",i,!0,{sourceMap:!1,shadowMode:!1})},"91d3":function(t,e,s){var i=s("a896");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=s("0ed3").default;n("5074fb24",i,!0,{sourceMap:!1,shadowMode:!1})},"92ff":function(t,e,s){"use strict";s("3d18")},a896:function(t,e,s){var i=s("5eaa");e=i(!1),e.push([t.i,".text-warning[data-v-9b1a93e8]{animation:flasher-9b1a93e8 2.5s linear infinite}@keyframes flasher-9b1a93e8{50%{opacity:0}}.shell-container[data-v-9b1a93e8]{height:100%;overflow:hidden}.shell-body[data-v-9b1a93e8]{padding:calc(var(--outline-width)*2);height:100%}.shell-body>.terminal.focus[data-v-9b1a93e8]{outline:var(--outline-width) solid var(--outline)}[data-v-9b1a93e8] .containerPicker.unlabeled-select{display:inline-block;min-width:200px;height:30px;min-height:30px;width:auto}.status[data-v-9b1a93e8]{align-items:center;display:flex;min-width:80px;height:30px;margin-left:10px}",""]),t.exports=e},bfea:function(t,e,s){"use strict";s("3527")},cf46:function(t,e,s){var i=s("5eaa");e=i(!1),e.push([t.i,".epinio-app-log .v-select.inline.vs--single.vs--open .vs__selected{position:inherit}",""]),t.exports=e},df43:function(t,e,s){var i=s("5eaa");e=i(!1),e.push([t.i,".epinio-app-shell .v-select.inline.vs--single.vs--open .vs__selected{position:inherit}",""]),t.exports=e},ef3b:function(t,e,s){var i=s("5eaa");e=i(!1),e.push([t.i,".title-inner[data-v-c5dcdb42],.title-inner-left[data-v-c5dcdb42],.title-inner-right[data-v-c5dcdb42]{display:flex;flex-direction:row}.logs-container[data-v-c5dcdb42]{height:100%;overflow:auto;padding:5px;background-color:var(--logs-bg);font-family:Menlo,Consolas,monospace;color:var(--logs-text)}.logs-container .closed[data-v-c5dcdb42]{opacity:.25}.logs-container .time[data-v-c5dcdb42]{white-space:nowrap;display:none;width:0;padding-right:15px;-webkit-user-select:none;-moz-user-select:none;user-select:none}.logs-container.show-times .time[data-v-c5dcdb42]{display:initial;width:auto}.logs-container .msg[data-v-c5dcdb42]{white-space:nowrap}.logs-container .msg .highlight[data-v-c5dcdb42]{color:var(--logs-highlight);background-color:var(--logs-highlight-bg)}.logs-container.wrap-lines .msg[data-v-c5dcdb42]{white-space:normal}[data-v-c5dcdb42] .containerPicker.unlabeled-select{display:inline-block;min-width:200px;height:30px;min-height:30px;width:auto}.log-action button[data-v-c5dcdb42]{border:0!important;min-height:30px;line-height:30px}.log-action>input[data-v-c5dcdb42],.status[data-v-c5dcdb42]{height:30px}.status[data-v-c5dcdb42]{align-items:center;display:flex;min-width:80px}.filter-popup>*[data-v-c5dcdb42]{margin-bottom:10px}.title-left[data-v-c5dcdb42]{display:flex}",""]),t.exports=e},ef44:function(t,e,s){"use strict";s("91d3")}}]);
//# sourceMappingURL=epinio-1.11.0-1.umd.min.windowComponents.js.map