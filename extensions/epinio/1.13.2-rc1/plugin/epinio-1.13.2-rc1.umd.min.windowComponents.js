(("undefined"!==typeof self?self:this)["webpackChunkepinio_1_13_2_rc1"]=("undefined"!==typeof self?self:this)["webpackChunkepinio_1_13_2_rc1"]||[]).push([[195],{7398:function(e,t,n){var a=n(47814);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var l=n(74825).A;l("931703e8",a,!0,{sourceMap:!1,shadowMode:!1})},12304:function(e,t,n){"use strict";n.r(t);var a=n(36758),l=n.n(a),o=n(40935),i=n.n(o),s=i()(l());s.push([e.id,".title-inner[data-v-66118bd8],.title-inner-left[data-v-66118bd8],.title-inner-right[data-v-66118bd8]{display:flex;flex-direction:row}.logs-container[data-v-66118bd8]{height:100%;overflow:auto;padding:5px;background-color:var(--logs-bg);font-family:Menlo,Consolas,monospace;color:var(--logs-text)}.logs-container .closed[data-v-66118bd8]{opacity:.25}.logs-container .time[data-v-66118bd8]{white-space:nowrap;display:none;width:0;padding-right:15px;-webkit-user-select:none;-moz-user-select:none;user-select:none}.logs-container.show-times .time[data-v-66118bd8]{display:initial;width:auto}.logs-container .msg[data-v-66118bd8]{white-space:nowrap}.logs-container .msg .highlight[data-v-66118bd8]{color:var(--logs-highlight);background-color:var(--logs-highlight-bg)}.logs-container.wrap-lines .msg[data-v-66118bd8]{white-space:normal}[data-v-66118bd8] .containerPicker.unlabeled-select{display:inline-block;min-width:200px;height:30px;min-height:30px;width:auto}.log-action button[data-v-66118bd8]{border:0!important;min-height:30px;line-height:30px}.log-action>input[data-v-66118bd8],.status[data-v-66118bd8]{height:30px}.status[data-v-66118bd8]{align-items:center;display:flex;min-width:80px}.filter-popup[data-v-66118bd8]>*{margin-bottom:10px}.title-left[data-v-66118bd8]{display:flex}",""]),t["default"]=s},14182:function(e,t,n){var a=n(63270);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var l=n(74825).A;l("24ea3166",a,!0,{sourceMap:!1,shadowMode:!1})},44051:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var a=n(9274),l=n(65359),o=n(78418),i=n(88339),s=n(50667),r=n(82331),c=n(60386),u=n(24323),d=n(94428),v=n(4364);const p={class:"pull-left ml-5"},f={class:"status pull-left"},g={key:0,class:"text-success"},h={key:1,class:"text-warning"},m={key:2,class:"text-error"};var b=(0,a.defineComponent)({__name:"ApplicationShell",props:{application:{type:Object,default:null},endpoint:{type:String,default:""},initialInstance:{type:String,default:null}},setup(e){const t=(0,l.Pj)(),b=t.getters["i18n/t"],w=e,{socket:y,isOpen:k,backlog:x,instanceChoices:E,getRootSocketUrl:_}=(0,c.useApplicationSocketMixin)(w),N=(0,a.ref)(!0),V=(0,a.ref)(null),S=(0,a.ref)(w.initialInstance||E.value[0]),C=(0,a.ref)(null),A=(0,a.ref)(null),B=(0,a.ref)(null),M=(0,a.ref)(null),D=(0,a.ref)(!1),L=(0,a.ref)(null),P={allowProposedApi:!0,cursorBlink:!0,useStyle:!0,fontSize:12};(0,a.watch)(()=>S.value,()=>{H()}),(0,a.onBeforeUnmount)(()=>{clearInterval(L.value),R()}),(0,a.onMounted)(async()=>{await $(),await H(),k.value=!0,clearInterval(L.value),L.value=setInterval(()=>{T()},6e4)});const $=async()=>{const e=getComputedStyle(document.querySelector("body")),t=await n.e(594).then(n.t.bind(n,84594,23)),a=await(0,i.kR)({fit:n.e(462).then(n.t.bind(n,34462,23)),webgl:n.e(382).then(n.t.bind(n,90382,23)),weblinks:n.e(338).then(n.t.bind(n,72338,23)),search:n.e(720).then(n.t.bind(n,720,23))}),l=new t.Terminal({theme:{background:e.getPropertyValue("--terminal-bg").trim(),foreground:e.getPropertyValue("--terminal-text").trim(),cursor:e.getPropertyValue("--terminal-cursor").trim(),selectionBackground:e.getPropertyValue("--terminal-selection").trim()},...P});A.value=new a.fit.FitAddon,B.value=new a.search.SearchAddon;try{M.value=new a.webgl.WebGlAddon}catch(o){M.value=null}l.loadAddon(A.value),l.loadAddon(B.value),l.loadAddon(new a.weblinks.WebLinksAddon),M.value&&l.loadAddon(M.value),l.open(V.value),T(),O(),l.onData(e=>{const t=`0${(0,r.KA)(e)}`;I(t)}),C.value=l},I=e=>{k.value?y.value.send(e):x.value.push(e)},U=()=>{C.value.clear()},z=async()=>{const{url:e,token:t}=await _();return(0,s.g)(e,{authtoken:t,instance:S.value})},H=async()=>{y.value&&(await y.value.disconnect(),y.value=null,C.value.reset());const e=await z();e&&(y.value=new o.hb(e,!1,0,"base64.channel.k8s.io"),y.value.addEventListener(o.Gn,()=>{k.value=!1,D.value=!0}),y.value.addEventListener(o.vg,e=>{k.value=!1,D.value=!1,v.error("Connect Error",e)}),y.value.addEventListener(o.HM,()=>{k.value=!0,D.value=!1,T(),O()}),y.value.addEventListener(o.tv,()=>{k.value=!1,D.value=!1}),y.value.addEventListener(o.Dm,e=>{const t=e.detail.data.substr(0,1),n=(0,r.u)(e.detail.data.substr(1));"1"===`${t}`?C.value.write(n):v.error(n)}),y.value.connect(),C.value.focus())},O=()=>{const e=x.value.slice();x.value=[];for(const t of e)y.value.send(t)},T=()=>{if(!A.value)return;A.value.fit();const{rows:e,cols:t}=A.value.proposeDimensions();if(!k.value)return;const n=`4${(0,r.KA)(JSON.stringify({Width:Math.floor(t),Height:Math.floor(e)}))}`;y.value.send(n)},R=()=>{y.value&&(y.value.disconnect(),y.value=null),C.value&&(C.value.dispose(),C.value=null)};return(e,t)=>{const n=(0,a.resolveComponent)("resize-observer"),l=(0,a.resolveDirective)("clean-html");return(0,a.openBlock)(),(0,a.createBlock)((0,a.unref)(d.A),{active:N.value,"before-close":R,class:"epinio-app-shell"},{title:(0,a.withCtx)(()=>[(0,a.unref)(E).length>1?((0,a.openBlock)(),(0,a.createBlock)((0,a.unref)(u.A),{key:0,value:S.value,"onUpdate:value":t[0]||(t[0]=e=>S.value=e),disabled:1===(0,a.unref)(E).length,class:"containerPicker auto-width pull-left",options:(0,a.unref)(E),clearable:!1,placement:"top"},null,8,["value","disabled","options"])):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("div",p,[(0,a.createElementVNode)("button",{class:"btn btn-sm bg-primary",onClick:U},(0,a.toDisplayString)((0,a.unref)(b)("wm.containerShell.clear")),1)]),(0,a.createElementVNode)("div",f,[(0,a.unref)(k)?((0,a.openBlock)(),(0,a.createElementBlock)("span",g,(0,a.toDisplayString)((0,a.unref)(b)("wm.connection.connected")),1)):D.value?(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createElementBlock)("span",h,null,512)),[[l,(0,a.unref)(b)("wm.connection.connecting")]]):((0,a.openBlock)(),(0,a.createElementBlock)("span",m,(0,a.toDisplayString)((0,a.unref)(b)("wm.connection.disconnected")),1))])]),body:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",{class:(0,a.normalizeClass)(["shell-container",{open:(0,a.unref)(k),closed:!(0,a.unref)(k)}])},[(0,a.createElementVNode)("div",{ref_key:"xterm",ref:V,class:"shell-body"},null,512),(0,a.createVNode)(n,{onNotify:T})],2)]),_:1},8,["active"])}}}),w=(n(7398),n(90212),n(47433));const y=(0,w.A)(b,[["__scopeId","data-v-7bc331ac"]]);var k=y},47814:function(e,t,n){"use strict";n.r(t);var a=n(36758),l=n.n(a),o=n(40935),i=n.n(o),s=i()(l());s.push([e.id,".epinio-app-shell .v-select.inline.vs--single.vs--open .vs__selected{position:inherit}",""]),t["default"]=s},56035:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return H}});var a=n(9274),l=n(65359),o=n(78418),i=n(23464),s=n.n(i),r=n(30002),c=n.n(r),u=n(50667),d=n(6198),v=n(92043),p=n(91462),f=n(24323),g=n(42200),h=n(20737),m=n(94428),b=n(60386),w=n(4364);const y={class:"title-inner log-action"},k={class:"title-inner-left"},x=["disabled"],E={class:"title-inner-right"},_={class:"status log-action text-center p-10",style:{"min-width":"80px"}},N={class:"log-action ml-5"},V=["placeholder"],S={class:"log-action ml-5"},C={class:"fixed",cellpadding:"0",cellspacing:"0"},A={class:"logs-body"},B={class:"time"},M={class:"msg"},D={key:1},L={colspan:"2",class:"msg text-muted"},P={key:2},$={colspan:"2",class:"msg text-muted"};var I=(0,a.defineComponent)({__name:"ApplicationLogs",props:{application:{type:Object,default:null},endpoint:{type:String,default:""},ansiToHtml:{type:Boolean,default:!1},initialInstance:{type:String,default:null}},setup(e){const t=(0,l.Pj)(),n=t.getters["i18n/t"],i=e,{socket:r,isOpen:I,backlog:U,instanceChoices:z,getRootSocketUrl:H}=(0,b.useApplicationSocketMixin)(i),O=(0,a.ref)(1),T=(0,a.ref)(""),R=(0,a.ref)(i.initialInstance||z[0]),j=(0,a.ref)([]),F=(0,a.ref)(null),W=(0,a.ref)(!1),q=(0,a.ref)(!0),G=(0,a.ref)(null),J=new(c()),K=t.getters["prefs/get"](p.az),Z=(0,a.ref)(t.getters["prefs/get"](p.Pu));(0,a.onMounted)(async()=>{await te();let e=ae.bind(G);G.value.addEventListener("scroll",e),F.value=setInterval(ne,100)}),(0,a.onBeforeUnmount)(()=>{const e=document.querySelector(".logs-container");e&&e.removeEventListener("scroll",ae),ce(),I.value=!1});const X=(0,a.computed)(()=>[...z.value,{label:"No Instance Filter",value:null}]),Q=(0,a.computed)(()=>{if(!T.value&&!R.value)return j.value;const e=new RegExp((0,v.$f)(T.value),"img"),t=[];for(const n of j.value){let a=n.rawMsg;if(R.value){const e=a.substring(1,a.length);if(!e.startsWith(R.value))continue}const l=a.match(e);if(!l)continue;const o=a.split(e);a="";while(o.length||l.length)o.length&&(a+=J.ansi_to_html(o.shift())),l.length&&(a+=`<span class="highlight">${J.ansi_to_html(l.shift())}</span>`);t.push({id:n.id,time:n.time,msg:a})}return t}),Y=(0,a.computed)(()=>{const e=(0,v.ZD)(t.getters["prefs/get"](p.DX)),n=(0,v.ZD)(t.getters["prefs/get"](p.G$));return`${e} ${n}`}),ee=async()=>{const{url:e,token:t}=await H();return(0,u.g)(e,{follow:!0,authtoken:t})},te=async()=>{r.value&&(await r.value.disconnect(),r.value=null,j.value=[]),j.value=[];const e=await ee();r.value=new o.hb(e,!0,0),r.value.setAutoReconnectUrl(async()=>await ee()),r.value.addEventListener(o.HM,()=>{I.value=!0}),r.value.addEventListener(o.tv,()=>{I.value=!1}),r.value.addEventListener(o.vg,e=>{I.value=!1,w.error("Connect Error",e)}),r.value.addEventListener(o.Dm,async e=>{let t;try{t=JSON.parse(e.detail.data)}catch(e){return void w.warn("Unable to parse websocket data: ",e)}const{PodName:n,Message:a}=t,l=`[${n}] ${a}`;U.value.push({id:O.value++,msg:i.ansiToHtml?J.ansi_to_html(l):l,rawMsg:l})}),r.value.connect()},ne=()=>{U.value.length&&(j.value.push(...U.value),U.value=[]),W.value&&(0,a.nextTick)(()=>{ie()})},ae=()=>{const e=G.value;W.value=e.scrollTop+e.clientHeight+2>=e.scrollHeight},le=()=>{j.value=[]},oe=e=>{const t=(new Date).toISOString().split(".")[0],n=`${i.application.nameDisplay}-${t}`;(0,d.PE)(n,j.value.map(e=>`${e.rawMsg}`).join("\n")).then(()=>e(!0)).catch(()=>e(!1))},ie=()=>{G.value.scrollTop=G.value.scrollHeight},se=()=>{t.dispatch("prefs/set",{key:p.Pu,value:Z.value})},re=e=>e?s()(e).format(Y.value):"",ce=()=>{r.value&&(r.value.disconnect(),r.value=null),clearInterval(F.value)};return(e,t)=>{const l=(0,a.resolveComponent)("VDropdown"),o=(0,a.resolveDirective)("clean-html");return(0,a.openBlock)(),(0,a.createBlock)((0,a.unref)(m.A),{active:q.value,"before-close":ce,class:"epinio-app-log"},{title:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",y,[(0,a.createElementVNode)("div",k,[(0,a.unref)(z).length>1?((0,a.openBlock)(),(0,a.createBlock)((0,a.unref)(f.A),{key:0,value:R.value,"onUpdate:value":t[0]||(t[0]=e=>R.value=e),disabled:1===(0,a.unref)(z).length,class:"containerPicker auto-width",options:X.value,clearable:!0,placement:"top",placeholder:"Filter by Instance"},null,8,["value","disabled","options"])):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("button",{class:"btn bg-primary ml-5",disabled:W.value,onClick:ie},(0,a.toDisplayString)((0,a.unref)(n)("wm.containerLogs.follow")),9,x),(0,a.createElementVNode)("button",{class:"btn bg-primary ml-5",onClick:le},(0,a.toDisplayString)((0,a.unref)(n)("wm.containerLogs.clear")),1),(0,a.createVNode)((0,a.unref)(h.A),{class:"ml-5",mode:"download",onClick:oe})]),t[4]||(t[4]=(0,a.createElementVNode)("div",{style:{flex:"1"}},null,-1)),(0,a.createElementVNode)("div",E,[(0,a.createElementVNode)("div",_,[(0,a.createElementVNode)("span",{class:(0,a.normalizeClass)({"text-success":(0,a.unref)(I),"text-error":!(0,a.unref)(I)})},(0,a.toDisplayString)((0,a.unref)(n)((0,a.unref)(I)?"wm.connection.connected":"wm.connection.disconnected")),3)]),(0,a.createElementVNode)("div",N,[(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>T.value=e),class:"input-sm",type:"search",placeholder:(0,a.unref)(n)("wm.containerLogs.search")},null,8,V),[[a.vModelText,T.value]])]),(0,a.createElementVNode)("div",S,[(0,a.createVNode)(l,{placement:"top"},{popper:(0,a.withCtx)(()=>[(0,a.createVNode)((0,a.unref)(g.S),{value:Z.value,"onUpdate:value":[t[2]||(t[2]=e=>Z.value=e),se],label:(0,a.unref)(n)("wm.containerLogs.wrap")},null,8,["value","label"])]),default:(0,a.withCtx)(()=>[t[3]||(t[3]=(0,a.createElementVNode)("button",{class:"btn bg-primary"},[(0,a.createElementVNode)("i",{class:"icon icon-gear"})],-1))]),_:1})])])])]),body:(0,a.withCtx)(()=>[(0,a.createElementVNode)("div",{ref_key:"body",ref:G,class:(0,a.normalizeClass)({"logs-container":!0,open:(0,a.unref)(I),closed:!(0,a.unref)(I),"show-times":(0,a.unref)(K)&&Q.value.length,"wrap-lines":Z.value})},[(0,a.createElementVNode)("table",C,[(0,a.createElementVNode)("tbody",A,[Q.value.length?((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,{key:0},(0,a.renderList)(Q.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)("tr",{key:e.id},[(0,a.withDirectives)((0,a.createElementVNode)("td",B,null,512),[[o,re(e.time)]]),(0,a.withDirectives)((0,a.createElementVNode)("td",M,null,512),[[o,e.msg]])]))),128)):T.value?((0,a.openBlock)(),(0,a.createElementBlock)("tr",D,[(0,a.createElementVNode)("td",L,(0,a.toDisplayString)((0,a.unref)(n)("wm.containerLogs.noMatch")),1)])):((0,a.openBlock)(),(0,a.createElementBlock)("tr",P,[(0,a.createElementVNode)("td",$,(0,a.toDisplayString)((0,a.unref)(n)("epinio.applications.wm.noData")),1)]))])])],2)]),_:1},8,["active"])}}}),U=(n(14182),n(80368),n(47433));const z=(0,U.A)(I,[["__scopeId","data-v-66118bd8"]]);var H=z},60386:function(e,t,n){"use strict";n.r(t),n.d(t,{useApplicationSocketMixin:function(){return s}});var a=n(65359),l=n(9274),o=n(32766),i=n(4364);function s(e){const t=(0,a.Pj)(),n=(0,l.ref)(null),s=(0,l.ref)(!1),r=(0,l.ref)([]),c=(0,l.computed)(()=>e.application.instances.map(e=>e.id)),u=async()=>{const{token:n}=await t.dispatch("epinio/request",{opt:{url:"/api/v1/authtoken"}}),a=!!t.getters["isSingleProduct"];let l="",s="";if(i.log(t),a){const e=t.getters[`${o.Pm}/singleProductCNSI`]();s=`/pp/v1/direct/ws/${e?.guid}`}else{const e=t.getters["clusterId"],n=t.getters[`${o.Bz}/byId`](o.F6.CLUSTER,e);l=n.api}return{url:`${l}${s}${e.endpoint}`.replace(/^http/,"ws"),token:n}};return{socket:n,isOpen:s,backlog:r,instanceChoices:c,getRootSocketUrl:u}}},63270:function(e,t,n){"use strict";n.r(t);var a=n(36758),l=n.n(a),o=n(40935),i=n.n(o),s=i()(l());s.push([e.id,".epinio-app-log .v-select.inline.vs--single.vs--open .vs__selected{position:inherit}",""]),t["default"]=s},80368:function(e,t,n){var a=n(12304);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var l=n(74825).A;l("0307dae3",a,!0,{sourceMap:!1,shadowMode:!1})},90212:function(e,t,n){var a=n(97060);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var l=n(74825).A;l("5ca08394",a,!0,{sourceMap:!1,shadowMode:!1})},97060:function(e,t,n){"use strict";n.r(t);var a=n(36758),l=n.n(a),o=n(40935),i=n.n(o),s=i()(l());s.push([e.id,".text-warning[data-v-7bc331ac]{animation:flasher-7bc331ac 2.5s linear infinite}@keyframes flasher-7bc331ac{50%{opacity:0}}.shell-container[data-v-7bc331ac]{height:100%;overflow:hidden}.shell-body[data-v-7bc331ac]{padding:calc(var(--outline-width)*2);height:100%}.shell-body>.terminal.focus[data-v-7bc331ac]{outline:var(--outline-width) solid var(--outline)}[data-v-7bc331ac] .containerPicker.unlabeled-select{display:inline-block;min-width:200px;height:30px;min-height:30px;width:auto}.status[data-v-7bc331ac]{align-items:center;display:flex;min-width:80px;height:30px;margin-left:10px}",""]),t["default"]=s}}]);
//# sourceMappingURL=epinio-1.13.2-rc1.umd.min.windowComponents.js.map