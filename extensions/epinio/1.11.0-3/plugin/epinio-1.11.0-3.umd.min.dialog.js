(("undefined"!==typeof self?self:this)["webpackJsonpepinio_1_11_0_3"]=("undefined"!==typeof self?self:this)["webpackJsonpepinio_1_11_0_3"]||[]).push([[1],{"4cf4":function(e,t,s){var a=s("5eaa");t=a(!1),t.push([e.i,".export-app-dialog__title[data-v-2bf0de9f]{margin-bottom:0}.export-app-dialog__tab[data-v-2bf0de9f]{min-height:110px}.progress-info span[data-v-2bf0de9f]{display:block;margin-bottom:10px}",""]),e.exports=t},7709:function(e,t,s){"use strict";s("cd71")},c840:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("GenericPrompt",e._b({ref:"genericPrompt",on:{close:e.close}},"GenericPrompt",e.config,!1),[t("h4",{staticClass:"text-default-text export-app-dialog__title",attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.t("epinio.applications.export.label"))+" ")]),t("template",{slot:"body"},[t("Tabbed",{on:{changed:e.resetErrors}},[t("Tab",{staticClass:"export-app-dialog__tab",attrs:{"label-key":"epinio.applications.export.manifest.title",name:"manifest",weight:3}},[t("p",[e._v(" "+e._s(e.t("epinio.applications.export.manifest.description"))+" ")])]),t("Tab",{staticClass:"export-app-dialog__tab",attrs:{"label-key":"epinio.applications.export.chartValuesImages.title",name:"chart",weight:2}},[t("p",[e._v(" "+e._s(e.t("epinio.applications.export.chartValuesImages.description"))+" ")]),t("Banner",{attrs:{color:"info"}},[e._v(" "+e._s(e.t("epinio.applications.export.chartValuesImages.banner"))+" ")]),e.showProgressBar?t("div",{staticClass:"progress-info text info mb-10 mt-20"},[e.step?t("span",[e._v(" "+e._s(e.t("epinio.applications.export.chartValuesImages.steps."+e.step))+" ")]):e._e(),t("PercentageBar",{staticClass:"progress-bar",attrs:{value:e.progressBar,"color-stops":e.colorStops,"preferred-direction":"MORE"}})],1):e._e()],1)],1)],1)],2)},o=[],r=s("8bbf"),i=s.n(r),n=s("1c22"),c=s("eb32"),p=s("0cb2"),l=s("38de"),h=s("5877"),d=s.n(h),f=s("c87d"),g=s("ea72"),u=s("90cd");const m={[u["c"].VALUES]:.1,[u["c"].CHART]:.1,[u["c"].IMAGE]:.7};var b={name:"ExportAppDialog",components:{GenericPrompt:n["a"],Banner:c["a"],PercentageBar:g["a"],Tabbed:p["a"],Tab:l["a"]},props:{resources:{type:Array,required:!0}},data(){return{config:{title:this.t("promptRemove.title"),applyMode:"export",applyAction:this.exportApplicationManifest},zipParts:this.resources[0].applicationParts.filter(e=>e!==u["c"].MANIFEST),showProgressBar:!1,percentages:{},step:null,cancelTokenSources:{},colorStops:{0:"--primary",100:"--primary"}}},mounted(){document.addEventListener("keyup",this.escapeHandler)},beforeDestroy(){document.removeEventListener("keyup",this.escapeHandler)},computed:{progressBar:{get(){return Object.keys(this.percentages).reduce((e,t)=>e+this.percentages[t]*(m[t]||1),0)},set(e){this.percentages={value:e}}}},methods:{async exportApplicationManifest(){this.enableDownload();const e=this.resources[0],t=async t=>{const s=new d.a;for(const e in t){const a={[u["c"].VALUES]:"yaml",[u["c"].CHART]:"tar.gz",[u["c"].IMAGE]:"tar"};s.file(`${e}.${a[e]}`,t[e])}const a=await s.generateAsync({type:"blob",compression:"STORE"});await Object(f["a"])(e.meta.name+"-helm-chart.zip",a,"application/zip")};if("#manifest"===this.$route.hash)await e.createManifest();else{const s=await this.zipParts.reduce(async(t,s)=>({...await t,[s]:await this.fetchPart(e,s)}),Promise.resolve({}));if(Object.values(s).some(e=>!e))return;this.toggleStep("zip"),await t(s),this.progressBar=100,await this.delayBeforeClose(1500)}},getCancelToken(){return this.$store.$axios.CancelToken},async fetchPart(e,t){return this.toggleStep(t,!0),this.cancelTokenSources[t]=this.getCancelToken().source(),await e.fetchPart(t,{onDownloadProgress:e=>{const s=e.srcElement.getResponseHeader("content-length")||e.srcElement.getResponseHeader("proxy-content-length");s&&i.a.set(this.percentages,t,Math.round(100*e.loaded/s)),e.loaded>0&&this.toggleStep(t)},cancelToken:this.cancelTokenSources[t].token}).catch(e=>{if(!this.$store.$axios.isCancel(e)){var s;this.disableDownload();const a=null!==(s=e.message)&&void 0!==s?s:this.t("epinio.applications.export.chartValuesImages.error",{part:t});throw new Error(a)}})},fetchCancel(){Object.keys(this.cancelTokenSources).forEach(e=>this.cancelTokenSources[e].cancel(e+" part: download cancelled."))},close(){"#manifest"!==this.$route.hash&&this.fetchCancel(),this.$emit("close")},escapeHandler(e){"Escape"===e.key&&this.close()},resetErrors(){this.$refs.genericPrompt&&(this.$refs.genericPrompt.errors=[])},enableDownload(){this.resetErrors(),this.showProgressBar=!0},disableDownload(){this.fetchCancel(),this.showProgressBar=!1,this.progressBar=0,this.toggleStep(null)},async delayBeforeClose(e){return await new Promise(t=>setTimeout(t,e))},toggleStep(e,t=!1){this.step=e?`${t?"preparing":"download"}.${e}`:null}}},_=b,w=(s("7709"),s("d802")),y=Object(w["a"])(_,a,o,!1,null,"2bf0de9f",null);t["default"]=y.exports},cd71:function(e,t,s){var a=s("4cf4");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=s("0ed3").default;o("3a2f453e",a,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=epinio-1.11.0-3.umd.min.dialog.js.map